<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>K·ªâ Y·∫øu To√†n Tr∆∞·ªùng 12</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: linear-gradient(135deg, #fce4ec, #f8bbd0);
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    color: #4a2c5a;
    overflow-x: hidden;
  }
  header {
    background: #fff0f6;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(74,44,90,0.3);
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
  }
  header h1 {
    margin: 0;
    font-size: 2.4em;
    letter-spacing: 2px;
  }
  main {
    max-width: 1000px;
    padding: 20px 15px 80px;
    margin: 0 auto;
  }
  form#message-form {
    background: #fff0f6cc;
    border-radius: 20px;
    max-width: 600px;
    margin: 0 auto 50px auto;
    padding: 20px 25px;
    box-shadow: 0 3px 20px rgb(74 44 90 / 0.3);
  }
  form#message-form h3 {
    margin-top: 0;
    color: #a32965;
    margin-bottom: 15px;
    text-align: center;
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: 700;
    font-size: 1.05em;
    color: #802753;
  }
  input[type="text"], select, textarea {
    width: 100%;
    border-radius: 12px;
    border: 2px solid #f48fb1;
    padding: 10px 15px;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    font-size: 1em;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, select:focus, textarea:focus {
    border-color: #a32965;
  }
  textarea {
    min-height: 70px;
  }
  input[type="file"] {
    margin-top: 8px;
    margin-bottom: 15px;
  }
  button#post-btn {
    background: #e91e63;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 35px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 700;
    display: block;
    width: 100%;
    box-shadow: 0 4px 8px rgba(233,30,99,0.6);
    transition: background 0.3s ease;
  }
  button#post-btn:hover, button#post-btn:focus {
    background: #ad1457;
  }
  #messages-board {
    max-width: 800px;
    margin: 0 auto 60px auto;
  }
  section.class-group {
    margin-bottom: 50px;
    padding: 10px 15px 20px;
    border-radius: 18px;
    background: #ffc1e3a1;
    box-shadow: 0 2px 20px rgba(244,143,177,0.4);
  }
  section.class-group h3 {
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    font-size: 1.8em;
    color: #a32965;
    border-bottom: 2px dashed #f48fb1;
    padding-bottom: 6px;
  }
  .message-card {
    background: #fce4eccc;
    border-radius: 20px;
    box-shadow: 0 3px 15px #d81b60aa;
    margin-bottom: 20px;
    padding: 15px 20px;
    position: relative;
    overflow-wrap: break-word;
  }
  .message-card h4 {
    margin: 0 0 8px;
    color: #880e4f;
  }
  .student-section {
    border-radius: 15px;
    padding: 12px 15px;
    background: #fff0f6;
    border: 2px solid #f48fb1;
  }
  .message-text {
    white-space: pre-wrap;
  }
  .message-media {
    margin-top: 8px;
    max-width: 100%;
    border-radius: 15px;
    box-shadow: 0 3px 10px #f48fb173;
  }
  .message-video {
    margin-top: 8px;
    width: 100%;
    max-height: 350px;
    border-radius: 15px;
    box-shadow: 0 3px 10px #f48fb173;
  }
  .congrats-frame {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: #fce4ec;
    border-radius: 25px;
    padding: 40px 60px;
    text-align: center;
    color: #ad1457;
    box-shadow: 0 5px 25px rgba(233, 30, 99, 0.7);
    font-size: 1.6em;
    font-weight: 700;
    filter: drop-shadow(0 0 12px #f48fb1);
    z-index: 9999;
    user-select: none;
    transition: transform 0.5s cubic-bezier(0.4, 1.45, 0.6, 1.4);
  }
  .congrats-frame.show {
    transform: translate(-50%, -50%) scale(1);
  }
  /* Hearts Animation */
  .heart {
    position: fixed;
    width: 20px;
    height: 20px;
    background: #f48fb1;
    transform: rotate(45deg);
    pointer-events: none;
    animation: floatUp 1.2s ease forwards;
    z-index: 10000;
    opacity: 0.8;
  }
  .heart::before,
  .heart::after {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: #f48fb1;
    border-radius: 50%;
  }
  .heart::before {
    top: -10px;
    left: 0;
  }
  .heart::after {
    left: 10px;
    top: 0;
  }
  @keyframes floatUp {
    0% {
      transform: translateY(0) rotate(45deg);
      opacity: 0.8;
    }
    100% {
      transform: translateY(-100px) rotate(45deg);
      opacity: 0;
    }
  }
  /* Responsive */
  @media (max-width: 700px) {
    main {
      padding: 10px 10px 70px;
    }
    form#message-form {
      max-width: 90vw;
      padding: 15px 20px;
    }
  }
</style>
</head>
<body>
<audio id="background-audio" autoplay loop>
  <source src="./12.m4a" type="audio/mpeg">
  Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ √¢m thanh.
</audio>

<header>
  <h1>K·ªâ Y·∫øu To√†n Tr∆∞·ªùng L·ªõp 12</h1>
  <p style="font-style: italic; color:#ad1457; margin-top:6px;">G·ª≠i l·ªùi ch√∫c & k·ªâ ni·ªám ng·ªçt ng√†o c·ªßa b·∫°n!</p>
</header>

<main>
  <form id="message-form" aria-label="Form ƒëƒÉng l·ªùi ch√∫c">
    <h3>ƒêƒÉng l·ªùi ch√∫c v√† k·ªâ ni·ªám</h3>

    <label for="fullname">H·ªç v√† t√™n:</label>
    <input type="text" id="fullname" name="fullname" placeholder="Nh·∫≠p h·ªç v√† t√™n" required autocomplete="off" />

    <label for="class-select">Ch·ªçn l·ªõp:</label>
    <select id="class-select" name="class-select" required>
      <option value="" disabled selected>Ch·ªçn l·ªõp</option>
      <option value="12 To√°n">12 To√°n</option>
      <option value="12 L√Ω">12 L√Ω</option>
      <option value="12 H√≥a">12 H√≥a</option>
      <option value="12 VƒÉn 1">12 VƒÉn 1</option>
      <option value="12 VƒÉn 2">12 VƒÉn 2</option>
      <option value="12 Sinh">12 Sinh</option>
    </select>

    <label for="message-text">L·ªùi ch√∫c / K·ªâ ni·ªám:</label>
    <textarea id="message-text" name="message-text" placeholder="Vi·∫øt l·ªùi ch√∫c ho·∫∑c k·ªâ ni·ªám..." required></textarea>

    <label for="media-input">Th√™m ·∫£nh / video (jpg, png, mp4):</label>
    <input type="file" id="media-input" name="media-input" accept="image/jpeg,image/png,video/mp4" multiple />
 <label for="signature-pad">K√Ω t√™n:</label>
<canvas id="signature-pad" width="400" height="150" style="border:2px solid #f48fb1; border-radius:11px; background:#fff;"></canvas>
<button type="button" id="clear-signature" style="margin-top: 8px; margin-bottom: 20px; background: #f48fb1; color:white; border:none; border-radius:20px; padding:5px 12px; cursor:pointer;">üßº X√≥a ch·ªØ k√Ω</button>
    <button id="post-btn" type="submit">ƒêƒÉng l·ªùi ch√∫c</button>
  </form>

  <div id="messages-board" aria-live="polite" aria-relevant="additions" aria-atomic="true">
    <!-- Messages grouped by class will appear here -->
  </div>
</main>

<div class="congrats-frame" id="congrats-frame" role="alert" aria-live="assertive" aria-atomic="true">L·ªùi ch√∫c c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i! üíñ</div>

<script>
  // Heart animation on mouse move and click
  const hearts = [];
  function createHeart(x, y) {
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.style.left = (x - 10) + 'px';
    heart.style.top = (y - 10) + 'px';
    document.body.appendChild(heart);
    hearts.push(heart);
    setTimeout(() => {
      heart.remove();
      hearts.splice(hearts.indexOf(heart), 1);
    }, 1200);
  }

  document.addEventListener('mousemove', e => {
    if (Math.random() < 0.04) { // not too many hearts, about 4% chance on mousemove
      createHeart(e.clientX, e.clientY);
    }
  });

  document.addEventListener('click', e => {
    for(let i=0; i<5; i++) {
      setTimeout(() => createHeart(e.clientX + (Math.random()*20-10), e.clientY + (Math.random()*20-10)), i * 40);
    }
  });

  const form = document.getElementById('message-form');
  const messagesBoard = document.getElementById('messages-board');
  const congratsFrame = document.getElementById('congrats-frame');

  const classOrder = [
    "12 To√°n",
    "12 L√Ω",
    "12 H√≥a",
    "12 VƒÉn 1",
    "12 VƒÉn 2",
    "12 Sinh"
  ];

  form.addEventListener('submit', e => {
    e.preventDefault();

    const fullname = form['fullname'].value.trim();
    const className = form['class-select'].value;
    const messageText = form['message-text'].value.trim();
    const mediaFiles = form['media-input'].files;

    if (!fullname || !className || !messageText) {
      alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√† l·ªùi ch√∫c.');
      return;
    }

    // Create message card container
    const card = document.createElement('article');
    card.className = 'message-card';
    card.tabIndex = 0;
    card.dataset.classname = className;
    card.setAttribute('aria-label', `L·ªùi ch√∫c t·ª´ ${fullname} l·ªõp ${className}`);
   

    // Student section
    const studentSection = document.createElement('section');
    studentSection.className = 'student-section';
    const studentHeader = document.createElement('h4');
    studentHeader.textContent = fullname + ' - ' + className;
    studentSection.appendChild(studentHeader);

    const studentMsg = document.createElement('p');
    studentMsg.className = 'message-text';
    studentMsg.textContent = messageText;
    studentSection.appendChild(studentMsg);
  // Th√™m ch·ªØ k√Ω (n·∫øu c√≥)
const signatureData = canvas.toDataURL();
if (signatureData && !signatureIsEmpty()) {
  const img = document.createElement('img');
  img.src = signatureData;
  img.alt = 'Ch·ªØ k√Ω';
  img.style.maxWidth = '200px';
  img.style.marginTop = '10px';
  img.className = 'message-media';
  studentSection.appendChild(img);
}
    // N√∫t x√≥a
const deleteBtn = document.createElement('button');
deleteBtn.textContent = 'üóë X√≥a';
deleteBtn.style.cssText = 'position:absolute; top:10px; right:15px; background:none; border:none; color:#ad1457; font-size:1.2em; cursor:pointer;';
deleteBtn.title = 'X√≥a l·ªùi ch√∫c';
deleteBtn.addEventListener('click', () => {
  if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªùi ch√∫c n√†y kh√¥ng?')) {
    card.remove();
    removeMessageFromStorage(fullname, className, messageText);
  }
});
card.appendChild(deleteBtn);

    // Append media to student section
    if (mediaFiles.length > 0) {
      for (let file of mediaFiles) {
        const type = file.type;
        const reader = new FileReader();
        reader.onload = (event) => {
          if (type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = event.target.result;
            img.alt = '·∫¢nh l·ªùi ch√∫c';
            img.className = 'message-media';
            studentSection.appendChild(img);
          } else if (type === 'video/mp4') {
            const video = document.createElement('video');
            video.controls = true;
            video.src = event.target.result;
            video.className = 'message-video';
            studentSection.appendChild(video);
          }
        };
        reader.readAsDataURL(file);
      }
    }

    card.appendChild(studentSection);

    // Insert or group by class
    addMessageToClassGroup(card, className);

    // Show congrats frame with animation
    congratsFrame.classList.add('show');
    setTimeout(() => {
      congratsFrame.classList.remove('show');
    }, 2500);
  // L∆∞u v√†o localStorage
const newMessage = {
  fullname,
  className,
  messageText,
  timestamp: Date.now()
};
const existingMessages = JSON.parse(localStorage.getItem('messages') || '[]');
existingMessages.push(newMessage);
localStorage.setItem('messages', JSON.stringify(existingMessages));
    form.reset();
    newMessage.signature = signatureIsEmpty() ? null : signatureData;
  });

  /**
   * Adds the given message card to the group for the className.
   * Creates the group container if it doesn't exist.
   * Ensures classes appear in order as in classOrder array.
   */
  function addMessageToClassGroup(card, className) {
    // Find or create container for class
    let classGroup = messagesBoard.querySelector(`section.class-group[data-class="${className}"]`);
    if (!classGroup) {
      classGroup = document.createElement('section');
      classGroup.className = 'class-group';
      classGroup.dataset.class = className;

      const heading = document.createElement('h3');
      heading.textContent = className;
      classGroup.appendChild(heading);

      // Insert group in correct order
      const existingGroups = Array.from(messagesBoard.querySelectorAll('section.class-group'));
      let inserted = false;
      for (let i = 0; i < existingGroups.length; i++) {
        const existingClass = existingGroups[i].dataset.class;
        if (classOrder.indexOf(className) < classOrder.indexOf(existingClass)) {
          messagesBoard.insertBefore(classGroup, existingGroups[i]);
          inserted = true;
          break;
        }
      }
      if (!inserted) messagesBoard.appendChild(classGroup);
    }

    // Insert card at top (newest first)
    classGroup.insertBefore(card, classGroup.children[1] || null); // after heading
  }
  // H√†m load l·∫°i l·ªùi ch√∫c t·ª´ localStorage
window.addEventListener('DOMContentLoaded', () => {
  const savedMessages = JSON.parse(localStorage.getItem('messages') || '[]');
  savedMessages.sort((a, b) => b.timestamp - a.timestamp); // M·ªõi nh·∫•t l√™n tr∆∞·ªõc
  for (let msg of savedMessages) {
    const card = document.createElement('article');
    card.className = 'message-card';
    card.tabIndex = 0;
    card.dataset.classname = msg.className;
    card.setAttribute('aria-label', `L·ªùi ch√∫c t·ª´ ${msg.fullname} l·ªõp ${msg.className}`);

    const studentSection = document.createElement('section');
    studentSection.className = 'student-section';
    const studentHeader = document.createElement('h4');
    studentHeader.textContent = msg.fullname + ' - ' + msg.className;
    studentSection.appendChild(studentHeader);

    const studentMsg = document.createElement('p');
    studentMsg.className = 'message-text';
    studentMsg.textContent = msg.messageText;
    studentSection.appendChild(studentMsg);

    card.appendChild(studentSection);
    addMessageToClassGroup(card, msg.className);
  }
});
function removeMessageFromStorage(fullname, className, messageText) {
  const stored = JSON.parse(localStorage.getItem('messages') || '[]');
  const updated = stored.filter(msg => {
    return !(msg.fullname === fullname && msg.className === className && msg.messageText === messageText);
  });
  localStorage.setItem('messages', JSON.stringify(updated));
}
document.addEventListener('click', () => {
  const audio = document.getElementById('background-audio');
  if (audio && audio.paused) {
    audio.play().catch(e => {
      console.warn("Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông:", e);
    });
  }
}, { once: true });
const canvas = document.getElementById('signature-pad');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.addEventListener('mousedown', e => {
  drawing = true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX, e.offsetY);
});
canvas.addEventListener('mousemove', e => {
  if (!drawing) return;
  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.strokeStyle = '#ad1457';
  ctx.lineWidth = 2;
  ctx.stroke();
});
canvas.addEventListener('mouseup', () => drawing = false);
canvas.addEventListener('mouseleave', () => drawing = false);

// Touch support
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  ctx.beginPath();
  ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
  drawing = true;
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  if (!drawing) return;
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
  ctx.strokeStyle = '#ad1457';
  ctx.lineWidth = 2;
  ctx.stroke();
});
canvas.addEventListener('touchend', () => drawing = false);

// X√≥a ch·ªØ k√Ω
document.getElementById('clear-signature').addEventListener('click', () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
});
function signatureIsEmpty() {
  const blank = document.createElement('canvas');
  blank.width = canvas.width;
  blank.height = canvas.height;
  return canvas.toDataURL() === blank.toDataURL();
}
if (msg.signature) {
  const sig = document.createElement('img');
  sig.src = msg.signature;
  sig.alt = 'Ch·ªØ k√Ω';
  sig.style.maxWidth = '200px';
  sig.className = 'message-media';
  studentSection.appendChild(sig);
}
</script>
</body>
</html>
